<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet"  href="style.css" />

    <title>Document</title>
</head>

<body>
    <main>
        <div id="count"></div>
        <div id="svg-container">
            <object id="obj-bot-svg" type="image/svg+xml" data="botfull.svg"></object>
        </div>
    </main>
</body>

<script type="text/javascript">
/////////////////////////////////////////////
//SVG MANIPUTLATION
var humorState = "sleep";
const svg = document.getElementById("obj-bot-svg");
var pupilsElts = [];

svg.addEventListener("load", function() {
    var fullSvg = svg.contentDocument;
    var botLayers = ["slash", "box", "parts", "face"];

    //link event awake bot on clic
    botLayers.forEach(function(elt) {
        let current = fullSvg.getElementById(elt);
        // current.addEventListener("click", awakeTheBot); 
        current.addEventListener("click", function(e) {
            clickOnBot(); 
            e.stopPropagation();

        });
    })
    // let botLayersElts = [];

    var pupils = [
        "pup_x5F_l_x5F_norm", "pup_x5F_r_x5F_norm", "pup_x5F_l_x5F_happy", "pup_x5F_r_x5F_happy", "pup_x5F_l_x5F_sleep", "pup_x5F_r_x5F_sleep", "pup_x5F_l_x5F_angry", "pup_x5F_r_x5F_angry"
    ];

    pupils.forEach(function(elt) {
        let current = fullSvg.getElementById(elt);
        pupilsElts.push(current);
    })
    
    pupilDisplayOnly("sleep");
})

function splitPathInstruction(paths) {
    console.log(paths);

    let arr = [];
    paths.forEach(path => {
        let instruction = path.getAttribute("d");
        instruction.replace("-", ",-");

        console.log(instruction);
        let splited = instruction.split(",");
        arr.push(splited);
    })
    
    console.log(arr);
}

/////////////////////////////////////////////
//TIMER
let counter = document.querySelector("#count");
let time, secondes = 0;

function startTime() { 
    counter.textContent = secondes;
    secondes++; 

    if(secondes >= 10) {
        let state = getState();
        if(state == "angry") {
            botReturnToNormal();
            resetTime();
        }
        else if(state == "norm") {
            botReturnToSleep();
            stopTime();
        }
    }
} 

function stopTime() {
	clearInterval(time); 
	secondes = 0; 
    counter.textContent = secondes;
}

function resetTime() {
    stopTime();
	time = setInterval(startTime, 1000);  
}
window.onload = resetTime;
window.ontouchstart = resetTime; 
window.onclick = resetTime; 
window.onkeypress = resetTime;
window.onmousemove = resetTime; 
// window.addEventListener("mousemove", resetTime);
window.onmousedown = resetTime;  

/////////////////////////////////////////////
//FUNCTION
function getState() {
    let actuallyDisplayed = whichPupAreDisplay();
    let arr = actuallyDisplayed[0].id.split("_");

    console.log("get state ", arr[arr.length - 1]);

    return arr[arr.length - 1];
}

function setHumorState(state) {
    humorState = state;
    console.log("humorState", humorState);
}

function whichPupAreDisplay() {
    let areDisplay = [];
    pupilsElts.forEach(path => {
        if(window.getComputedStyle(path).display != "none") {
            areDisplay.push(path);
        }
    })
    // console.log(areDisplay);
    return areDisplay;
}

function pupilDisplayOnly(str) {
    console.log("display only " + str);
    pupilsElts.forEach(pup => {
        if(!pup.id.includes(str)) {
            pup.style.display = "none";
        }
        else {
            pup.style.display = "inline";
            console.log(pup.id, window.getComputedStyle(pup).display);
        }
    })
}


function angerTheBot() {
    console.log("anger");
    pupilDisplayOnly("angry");
    setHumorState("angry");
    // botReturnToNormal();
}

function awakeTheBot() {
    console.log("awake");
    pupilDisplayOnly("norm");
    setHumorState("norm");

    // botReturnToSleep();
}

function furyTheBot() {
    console.log("fury");
    let displayed = whichPupAreDisplay();

    if(displayed[0].id.includes("angry")) {
        displayed.forEach(path => {
        redEyes(path);
    })
    }
}

function botReturnToNormal() {
        console.log("return to normal");
        pupilDisplayOnly("norm");
        setHumorState("norm");

        whichPupAreDisplay().forEach(path => {
            normColorEyes(path);
        })
}

function botReturnToSleep() {
        console.log("return to sleep");
        pupilDisplayOnly("sleep");
        setHumorState("sleep");
}


function clickOnBot() {
    console.log("clic");

    let state = getState();
    if(state == "sleep") {
        awakeTheBot();
    }
    else if(state == "angry") {
        furyTheBot();
    }
    else if(state = "norm") {
        angerTheBot();
    }
}


function redEyes(path) {
    console.log("red");
        path.style.fill = "#ff0000";
        path.style.transition = "fill 2s ease";
}

function normColorEyes(path) {
    console.log("normal eyes color");

    path.style.fill = "#414042";
    path.style.transition = "fill 4s ease";
}



let svgContainer = document.querySelector("#svg-container");
svgContainer.addEventListener("mousemove", function(e) {
    console.log(e)
    resetTime();
    test(e);
})
let body = document.querySelector("body");
window.addEventListener("mousemove", function(e) {
    resetTime();
    test(e)
    // if(humorState === "norm") {
    //     splitPathInstruction(whichPupAreDisplay());

    //     console.log(e.clientX, e.clientY);
    //     if(e.clientX < 180) {
    //         pupilsElts[0].setAttribute("d", "M210.033, 124.789c0, 6.339-5.131, 11.465-11.464, 11.465c-6.338, 0 -11.465, -5.126 -11.465, -11.465c0 -6.331, 5.127 -11.464, 11.465 -11.464C204.902, 113.325, 210.033, 118.458, 210.033, 124.789z");
    //     }
    //     else if(e.clientX > 180 && e.clientX < 287) {
    //         pupilsElts[0].setAttribute("d", "M215.033,124.789c0,6.339-5.131,11.465-11.464,11.465c-6.338,0-11.465-5.126-11.465-11.465c0-6.331,5.127-11.464,11.465-11.464C209.902,113.325,215.033,118.458,215.033,124.789z");
    //     }
    //     else if(e.clientX > 287) {
    //         pupilsElts[0].setAttribute("d", "M220.033, 124.789c0,6.339-5.131,11.465-11.464, 11.465c-6.338,0-11.465,-5.126-11.465,-11.465c0-6.331,5.127-11.464,11.465 -11.464C214.902, 113.325, 220.033, 118.458, 220.033,124.789z");
    //     }
    // }
}); 
function test(e) {
    if(humorState === "norm") {
        // splitPathInstruction(whichPupAreDisplay());

        console.log(e.clientX, e.clientY);
        if(e.clientX < 180) {
            pupilsElts[0].setAttribute("d", "M210.033, 124.789c0, 6.339-5.131, 11.465-11.464, 11.465c-6.338, 0 -11.465, -5.126 -11.465, -11.465c0 -6.331, 5.127 -11.464, 11.465 -11.464C204.902, 113.325, 210.033, 118.458, 210.033, 124.789z");
        }
        else if(e.clientX > 180 && e.clientX < 287) {
            pupilsElts[0].setAttribute("d", "M215.033,124.789c0,6.339-5.131,11.465-11.464,11.465c-6.338,0-11.465-5.126-11.465-11.465c0-6.331,5.127-11.464,11.465-11.464C209.902,113.325,215.033,118.458,215.033,124.789z");
        }
        else if(e.clientX > 287) {
            pupilsElts[0].setAttribute("d", "M220.033, 124.789c0,6.339-5.131,11.465-11.464, 11.465c-6.338,0-11.465,-5.126-11.465,-11.465c0-6.331,5.127-11.464,11.465 -11.464C214.902, 113.325, 220.033, 118.458, 220.033,124.789z");
        }
    }
}
function followMouse(clientX, clientY) {
    console.log(clientX, clientY);

        if(clientX < 180) {
            
        }
        else if(clientX > 180 && clientX < 287) {
        }
        else if(clientX > 287) {
            console.log("!!!!");

            // pupilsElts[0].setAttribute("d", "M220.033, 124.789c0, 6.339-5.131, 11.465-11.464, 11.465c-6.338, 0 -11.465, -5.126 -11.465, -11.465c0 -6.331, 5.127 -11.464, 11.465 -11.464C214.902, 113.325, 220.033, 118.458, 220.033, 124.789z");
        }

        // if(clientY < 95) {
        //     divEyes.style.top = "-4px";
        // }
        // else if(clientY > 95 && clientY < 135) {
        //     divEyes.style.top = "0";
        // }
        // else if(clientY > 135) {
        //     divEyes.style.top = "4px";
        // }
} 
//////////////////////////////////////////////////////////
//STOCK GARBAGE
    // window.addEventListener("mousemove", function(e) {
    //     console.log(e.clientX, e.clientY);
function followMouse(e) {
    if(e.clientX < 180) {
            divEyes.style.left = "-4px";
        }
        else if(e.clientX > 180 && e.clientX < 287) {
            divEyes.style.left = "0";
        }
        else if(e.clientX > 287) {
            divEyes.style.left = "4px";
        }

        if(e.clientY < 95) {
            divEyes.style.top = "-4px";
        }
        else if(e.clientY > 95 && e.clientY < 135) {
            divEyes.style.top = "0";
        }
        else if(e.clientY > 135) {
            divEyes.style.top = "4px";
        }

} 

</script>
</html>